@model IEnumerable<AAOAdmin.Models.DriversAvailable>
@using static AAOAdmin.Controllers.UsersController

@{ ViewData["Title"] = "Chauffører";
  Layout = "~/Views/Shared/_Layout.cshtml";

    }

<h1>Chauffører</h1> 
<table class="table">
  <thead>
    <tr>
      <th>
        Ledighed
      </th>
      <th>
        Fulde navn
      </th>
      <th>
        Telefonnummer
      </th>
      <th>
        Lokation
      </th>
      <th>
        Land
      </th>
      <th>
        
      </th>
    </tr>
  </thead>
  <tbody>
    @foreach (var item in Model)
    {
<tr>
  <td>
    @item.DriversAvailableDate
  </td>
  <td>
    @item.User.UserFullName
  </td>
  <td>
    @item.User.UserPhoneNumber
  </td>
  <td>
    @Html.DisplayFor(modelItem => item.User.DriverInformation.Location.LocationPostalCode)

    @Html.DisplayFor(modelItem => item.User.DriverInformation.Location.City.CityName)
  </td>
  <td>
    @Html.DisplayFor(modelItem => item.User.DriverInformation.Location.City.Country.CountryName)
  </td>
  <td>
    <button asp-route-id="@item.UserId" onclick="switchModal(@item.UserId)" runat="server" text="Button" OnClientClick="return false;" id="myBtn">Tildel tur</button>

  </td>


</tr>
}
  </tbody>
</table>


<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <table class="table">
      <thead>
        <tr>
          <th>
            Start Date
          </th>
          <th>
            End Date
          </th>
          <th>
            Department name
          </th>
          <th>
            Start Location
          </th>
          <th>
            End Location
          </th>
          <th>
            Status
          </th>
          <th>

          </th>
        </tr>
      </thead>
      <tbody>
        @foreach (var item in ViewBag.Routes)
        {
          <tr>
            <td>
              @item.RouteStartDate
            </td>
            <td>
              @item.RouteEndDate
            </td>
            <td>
              @item.Department.DepartmentName
            </td>
            <td>
              @item.RouteStartLocation.LocationAddress
            </td>
            <td>
              @item.RouteEndLocation.LocationAddress
            </td>
            <td>
              @item.RouteStatus.RouteStatusName
            </td>
            <td>
              <div><button id="myBtn" onclick="assignRoute(@item.RouteId)">Tildel</button></div>
            </td>
          </tr>
}
      </tbody>
    </table>
  </div>
</div>



      <script>

        fetch('https://localhost:44389/api/routesapi/')
          .then(response => response.json())
          .then(data => console.log(data));

        let userId = null; 
        // Get the modal
        let modal = document.getElementById("myModal");

        // Get the button that opens the modal
        let btn = document.querySelectorAll("#myBtn");

        // Get the <span> element that closes the modal
        let span = document.getElementsByClassName("close")[0];


        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
          userId = null;

          modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
          if (event.target == modal) {
            userId = null;

            modal.style.display = "none";
          }
        }

        function switchModal(uId = null) {
          modal.style.display = "block";
          userId = uId;
          console.log(userId);
        }

        async function assignRoute(routeId) {
          console.log(routeId, userId)

          if (routeId && userId) {
  
            const response = await fetch(`https://localhost:44389/api/routesapi/${routeId}/${userId}`, {method:"PUT"})
             .then(response => response.json())
             console.log(response)

            window.alert("Chaufføren fik tildelt ruten");
            window.location.reload();
          }
        }

        
            


      </script>
